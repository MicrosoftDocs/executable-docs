#cloud-config
package_update: true
package_upgrade: true
runcmd:
  - curl https://packages.microsoft.com/config/ubuntu/22.04/packages-microsoft-prod.deb > packages-microsoft-prod.deb
  - dpkg -i packages-microsoft-prod.deb
  - apt-get update
  - apt-get install aziot-edge -y
  - |
    CONNECTION_STRING="$(az iot hub device-identity connection-string show \
      --device-id myEdgeDevice \
      --hub-name $IOTHUB_NAME \
      -o tsv)"
    iotedge config mp --connection-string "$CONNECTION_STRING"
    iotedge config apply